--SCRIPT CORRIGIR PROF_ID DIFERENTES ENTRE FAMILIA E PESSOA_FAMILIA_LOG –DAVI SILVA – 28/08/14
UPDATE SIABFACIL.PESSOA_FAMILIA_LOG SET PROF_ID = FAMILIA.PROF_ID
FROM SIABFACIL.FAMILIA
WHERE PESSOA_FAMILIA_LOG.FAMILIA_ID = FAMILIA.ID
AND PESSOA_FAMILIA_LOG.PESSOA_ID IN
(SELECT B.PESSOA_ID
FROM SIABFACIL.PESSOA A
INNER JOIN SIABFACIL.PESSOA_FAMILIA_LOG B
ON A.ID = B.PESSOA_ID
INNER JOIN SIABFACIL.FAMILIA C
ON C.ID = A.FAMILIA_ID
WHERE B.PROF_ID <> C.PROF_ID
AND B.DATA_SAIDA IS NULL
)
AND DATA_SAIDA IS NULL
AND PESSOA_FAMILIA_LOG.PROF_ID <> FAMILIA.PROF_ID