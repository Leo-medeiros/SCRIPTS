--Portadores de HIV com data da última consulta
USE RECEPCAO;
SELECT DISTINCT C.NOME AS NOME_DO_PACIENTE, C.NOMEEQUIPE AS NOME_DA_EQUIPE, C.SEXO, CONVERT (VARCHAR(10), 
DATA_NASCIMENTO,103) AS DATA_NASCIMENTO, C.MAE, D.CID10, D.DESCR,
(SELECT TOP 1 CONVERT (VARCHAR(10), dtatende,103 )  FROM pepmovimentos x where x.codpac=c.idpep order by codigo desc) AS DATA_ULTIMO_ATENDIMENTO
FROM INDICADORES.VW_PEP_SIAB C
INNER JOIN PEPMOVIMENTOS A ON C.IDPEP = A.CODPAC
INNER JOIN PepMovimentos_CID B ON A.CODIGO = B.id_PepMovimentos
INNER JOIN CID D ON B.id_cid = D.ID
WHERE D.ID in(2001
,2002
,2003
,2004
,2005
,2006
,2007
,2008
,2009
,2010
,2011) --Informar id da tabela cid
ORDER BY C.NOMEEQUIPE


--SELECT * FROM CID
--WHERE CID10 IN ('e10','e100','e101','e102','e103','e104','e105','e106','e107','e108','e109')